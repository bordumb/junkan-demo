name: Jnkn Impact Analysis

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write # Required to post comments

jobs:
  impact-analysis:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Important: Fetch full history for diffing

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install Jnkn
        # In a real scenario, you'd pip install jnkn.
        # For this demo, we'll install it directly from PyPI (assuming you've published)
        # OR you can install from git if your repo is public:
        run: pip install jnkn 

      - name: Run Jnkn Diff & Comment
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Initialize & Scan
          jnkn init --force --no-telemetry
          jnkn scan
          
          # 2. Generate Markdown Report
          # Compare the PR base against the PR head
          jnkn diff origin/${{ github.base_ref }} HEAD --format markdown > report.md
          
          # 3. Post Comment
          gh pr comment ${{ github.event.pull_request.number }} --body-file report.md